import requests
import datetime
import time

subreddit = "cybersecurity"
# subreddit = "MarketTalksDW"

for month in reversed(range(95)):
    print("Sending request before month: " + str(month) + " and after month: " + str(month + 1) + " from today.")
    response = requests.get(
        "http://api.pushshift.io/reddit/search/submission/?subreddit=" + subreddit + "&size=1000&before=" + str(
            month * 30) + "d&after=" + str((month + 1) * 30) + "d&metadata=true")
    collected_on = datetime.datetime.now().strftime("%Y%m%d%H%M%S")

    if response.status_code == 200:

        # print("hello there")
        with open("/storagemount/data/" + subreddit + "_" + collected_on + ".json", 'w+',
                  encoding="utf8") as file:
            file.write(response.text)
    else:
        print("Error received with error code: " + str(response.status_code))

    time.sleep(3)
