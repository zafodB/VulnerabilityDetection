"""

"""

import os

from neuralNetFirst import build_model, initial_setup, load_data
from neuralNetFirst.nn_config import *

if RUN_GPU_CONFIG:
    initial_setup()

print("Starting up")

# Define the shape using local config file and build model
features_shape = (DAYS, POSTS_PER_DAY, MAX_WORDS_PER_POST, EMBEDDING_LENGTH)
model = build_model(DAYS, POSTS_PER_DAY, EMBEDDING_LENGTH, MAX_WORDS_PER_POST, TARGET_VECTOR_LENGTH)


train_dataset = load_data(data_directory_path, features_shape, TARGET_VECTOR_LENGTH, batches=10, prefetch=2)

print("Fitting model")
model.fit(train_dataset, epochs=10)

if not os.path.isdir(model_directory_path):
    os.mkdir(model_directory_path)

model.save_weights(os.path.join(model_directory_path, 'model_weights'), overwrite=True)
